<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todo List 실습</title>
  <style>@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
  </style>
  <link rel="stylesheet" href="./01_todolist.css">
  <script src="./01_todolist.js"></script>
</head>
<body bgcolor="5f5f5f">
  <div class="todo-container">
    <h1>나의 Todo List</h1>
    <div class="input-group">
      <input type="text" id="todo-input" placeholder="새로운 할 일을 추가하세요 ✌️">
      <button id="add-btn">추가</button>
    </div>
    <ul id="todo-list" class="todo-list">
      <!-- 버튼을 눌렀을 때 <li> 태그가 추가되어야 함. -->
        <!-- 이거 분명히 html에 있는데 새로 켜보시면 없을 겁니다. 
        그 이유는 저희가 처음 사이트에 들어가거나 혹은 새로고침을 했을 때
        renderTodos()가 호출되는데, 그때 localStorage에 있는 것들만 보여주기로 코드를 작성했으니까요. -->
      <li class="todo-item">
        <input type="checkbox" class="completed">
        <span class="todo-text">todolist 만들기</span>
        <button class="delete-btn">삭제</button>
      </li>
      <ul>
  </div>
  <script>
    // DOM 요소 가져오기 위한 변수 선언 및 초기화
    const todoInput = document.getElementById("todo-input");
    const addBtn = document.getElementById('add-btn');
    const todoList = document.getElementById('todo-list');

    // 처음 페이지에 들어앇을 때 localStorage 를 참조해서 기존 todo 데이터가 있다면 가지고 와야겠네요.
    let todos = JSON.parse(localStorage.getItem('todos')) || [];
    // 있으면 가지고 오고 없으면 빈 배열 가져오라는 뜻

    // Todo 리스트를 불러오는 과정이 필요합니다.
    function renderTodos() {
      // 기존 todo list를 초기화 -> 추가했을 때 누적 안되게 
      todoList.innerHTML = '';

      // todos 배열을 반복 돌려서 목록을 생성
      todos.forEach((todo, index) => {
        // todos의 반복을 돌면 내부 element가 있을 건데, 그때마다 
        // li 태그를 생성한다는 의미
        const li = document.createElement('li');
        // li 태그만 만들었지 클래스 이름 안정했으니까
        li.className = 'todo-item';
        if(todo.completed) {
          li.classList.add('completed');
        }

        //체크 박스 - input 태그니까
        const checkbox = document.createElement('input');
        // 근데 얘는 type이 text가 아니라 checkbox니까
        checkbox.type = 'checkbox';
        checkbox.checked = todo.completed;

        // 텍스트 내용 생성 - span 태그
        const span = document.createElement('span');
        span.className = 'todo-text';
        span.textContent = todo.text;

        // 삭제 버튼 - button 태그
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.innerHTML = '&times';   // x 기호

        // 요소들을 li 변수에 추가해야 합니다. 왜? li 내부에 체크박스 / 스팬 / 버튼
        li.append(checkbox);
        li.append(span);
        li.append(deleteBtn);

        // 그리고 이 li를 <ul> 태그에 추가해야겠습니다.
        todoList.appendChild(li);

        // 이벤트리스터 추가
        // 체크박스 변경 이벤트
        checkbox.addEventListener('change', () => {
          todos[index].completed = checkbox.checked;  // checkbox가 type 이고, checked는 속성에 해당했습니다.
        // 완료 상태에 따라 CSS 클래스를 토글
          li.classList.toggle('completed', checkbox.checked);
          saveTodos();
        });

        // 삭제 버튼 클릭 이벤트
        deleteBtn.addEventListener('click', () => {
          // splice()를 사용하여 '배열에서 '해당' 항목 제거'
          todos.splice(index, 1);
          // DOM 에서 제거해야합니다. 즉, li 태그를 하나 날려야해요.
          li.remove();
          saveTodos;

        })
      })
      
      }
      function saveTodos() {
        // localStorage에 저장한다는 의미였으니까
        localStorage.setItem('todos', JSON.stringify(todos));
      }
      
      function addTodo() {
        const todoText = todoInput.value.trim();  // trim() 공백제거
        if(todoText === '') {
          alert('내용을 입력하세요! ');
          return;
        }

      //  input 창에 내용이 있다면 내용이 들어갈 JS  객체 선언
      const newTodo = {
        text: todoText,
        completed: false,
      };

      // todos에 새로운 todo를 추가
      todos.push(newTodo);
      
      // 추가한 이후에 input 태그 내의 내용을 비우는 역할
      todoInput.value = '';

      renderTodos();
      saveTodos();
    }

    // '추가' 버튼 클릭 이벤트
    addBtn.addEventListener('click', addTodo); // onclick에 addTodo를 추가하는 방식


    // 엔터 키 입력 이벤트
    todoInput.addEventListener('keydown', (event) => {
      if(event.key ==='Enter') {
        addTodo();  // input 태그에 Enter키 입력을 감지하면 addTodo(); 함수를 호출할 것.
      }
    });

    // 새로고침 했을 때 renderTodos() 가 호출 되어야 함.
    window.onload = renderTodos();
    
  </script>
</body>
</html>